\hypertarget{pico_8c}{\section{/\+Users/ysp/pico/src/pico.c File Reference}
\label{pico_8c}\index{/\+Users/ysp/pico/src/pico.\+c@{/\+Users/ysp/pico/src/pico.\+c}}
}


Implementation and private A\+P\+I for C\+Pico.  


{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdbool.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$inttypes.\+h$>$}\\*
{\ttfamily \#include $<$pico\+\_\+errno.\+h$>$}\\*
{\ttfamily \#include $<$pico\+\_\+defs.\+h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{pico_8c_a163fdf4775fad44f81a5cf0def9552a9}{T\+R\+Y}(m\+\_\+operation)~if (m\+\_\+operation != 0)
\begin{DoxyCompactList}\small\item\em Simple macro to check for an error using the usual non-\/zero return value. \end{DoxyCompactList}\item 
\hypertarget{pico_8c_ab20e112cce996ecb52f52116be6d8e33}{\#define {\bfseries M\+A\+L\+L\+O\+C}(m\+\_\+thing, m\+\_\+number)~(m\+\_\+thing $\ast$)calloc(m\+\_\+number, sizeof(m\+\_\+thing))}\label{pico_8c_ab20e112cce996ecb52f52116be6d8e33}

\item 
\hypertarget{pico_8c_a5ff982bf77b54d392189ed258beaefe0}{\#define {\bfseries F\+R\+E\+E}(m\+\_\+ptr)~((m\+\_\+ptr == N\+U\+L\+L) ? N\+U\+L\+L \+: free(m\+\_\+ptr), N\+U\+L\+L)}\label{pico_8c_a5ff982bf77b54d392189ed258beaefe0}

\item 
\hypertarget{pico_8c_aea3cfda4f3a9f978ec759f206cf186fe}{\#define {\bfseries C\+H\+U\+N\+K\+\_\+\+S\+I\+Z\+E}~4096}\label{pico_8c_aea3cfda4f3a9f978ec759f206cf186fe}

\item 
\#define \hyperlink{pico_8c_a69eb2cda55434e5ca8f3fe39f1fd7e1f}{E\+R\+R}(m\+\_\+err, m\+\_\+fmt,...)~if ((m\+\_\+err) != N\+U\+L\+L) fprintf((m\+\_\+err), (m\+\_\+fmt), \#\#\+\_\+\+\_\+\+V\+A\+\_\+\+A\+R\+G\+S\+\_\+\+\_\+)
\begin{DoxyCompactList}\small\item\em Print an error message. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{pico_8c_adf2b69a7537df96d4c1715b9916aa6a6}{pico\+\_\+free} (void $\ast$ptr)
\begin{DoxyCompactList}\small\item\em Deallocate the given memory. \end{DoxyCompactList}\item 
\hypertarget{pico_8c_a6761e986f9b47fab548e63545c586105}{void {\bfseries pico\+\_\+dump\+\_\+header} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico, F\+I\+L\+E $\ast$out)}\label{pico_8c_a6761e986f9b47fab548e63545c586105}

\item 
\hypertarget{pico_8c_a77c2944c18c56a1464f4b976e1839adf}{\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$ {\bfseries pico\+\_\+new} (F\+I\+L\+E $\ast$file, uint16\+\_\+t keylength, uint8\+\_\+t $\ast$key, uint32\+\_\+t md\+\_\+length)}\label{pico_8c_a77c2944c18c56a1464f4b976e1839adf}

\item 
\hypertarget{pico_8c_a0909a04c943607db9a31067c514c8274}{\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$ {\bfseries pico\+\_\+open} (F\+I\+L\+E $\ast$file)}\label{pico_8c_a0909a04c943607db9a31067c514c8274}

\item 
\hypertarget{pico_8c_a125ac76730e14b27e7b90684cbd674b5}{void {\bfseries pico\+\_\+finish} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a125ac76730e14b27e7b90684cbd674b5}

\item 
\hypertarget{pico_8c_ab8fcc943f3299f72a7e7c652d7d556c9}{bool {\bfseries pico\+\_\+is\+\_\+error} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_ab8fcc943f3299f72a7e7c652d7d556c9}

\item 
\hypertarget{pico_8c_a253f9c7ebab0a92376af42e542ad3714}{\hyperlink{pico__errno_8h_a7ddd7f611d53c5fe4d792f093a08ef48}{pico\+\_\+errno} {\bfseries pico\+\_\+get\+\_\+errno} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a253f9c7ebab0a92376af42e542ad3714}

\item 
\hypertarget{pico_8c_a7ba0327831326b158686a6a34d9c910f}{char $\ast$ {\bfseries pico\+\_\+print\+\_\+error} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a7ba0327831326b158686a6a34d9c910f}

\item 
\hypertarget{pico_8c_a70b206fec3a00900688514da2e79660e}{void {\bfseries pico\+\_\+clear\+\_\+error} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a70b206fec3a00900688514da2e79660e}

\item 
\hypertarget{pico_8c_a1e77126b56216ef084fbfa3f0caba21d}{magic\+\_\+t {\bfseries pico\+\_\+magic} ()}\label{pico_8c_a1e77126b56216ef084fbfa3f0caba21d}

\item 
\hypertarget{pico_8c_ab5662dc8478d04a68c361f325ebf2a58}{major\+\_\+t {\bfseries pico\+\_\+major} ()}\label{pico_8c_ab5662dc8478d04a68c361f325ebf2a58}

\item 
\hypertarget{pico_8c_a48a803cd1128096142573a91b6f3a08d}{minor\+\_\+t {\bfseries pico\+\_\+minor} ()}\label{pico_8c_a48a803cd1128096142573a91b6f3a08d}

\item 
\hypertarget{pico_8c_a85ee54ba30e5a1164a6574f14857fc03}{major\+\_\+t {\bfseries pico\+\_\+get\+\_\+major} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a85ee54ba30e5a1164a6574f14857fc03}

\item 
\hypertarget{pico_8c_a8ba170975705025eceab9c25184e8891}{minor\+\_\+t {\bfseries pico\+\_\+get\+\_\+minor} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a8ba170975705025eceab9c25184e8891}

\item 
\hypertarget{pico_8c_a8d745629eb6269804914a8a88f2c2dd6}{offset\+\_\+t {\bfseries pico\+\_\+get\+\_\+offset} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a8d745629eb6269804914a8a88f2c2dd6}

\item 
\hypertarget{pico_8c_afd5b6927ca9b2d846bb8d6c27500aea3}{uint8\+\_\+t $\ast$ {\bfseries pico\+\_\+get\+\_\+hash} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_afd5b6927ca9b2d846bb8d6c27500aea3}

\item 
\hypertarget{pico_8c_af3979ec9b9914b4e8695dcaa21bb064a}{keylen\+\_\+t {\bfseries pico\+\_\+get\+\_\+key\+\_\+length} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_af3979ec9b9914b4e8695dcaa21bb064a}

\item 
\hypertarget{pico_8c_a9c4a763b01398eb6044740a8a11508d0}{uint8\+\_\+t $\ast$ {\bfseries pico\+\_\+get\+\_\+key} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a9c4a763b01398eb6044740a8a11508d0}

\item 
\hypertarget{pico_8c_a4285e8f06a8ef22eec3cb6304995f230}{size\+\_\+t {\bfseries pico\+\_\+get\+\_\+md\+\_\+length} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico)}\label{pico_8c_a4285e8f06a8ef22eec3cb6304995f230}

\item 
\hypertarget{pico_8c_a61cae890d818d0d96c89ced46eb55fa6}{uint8\+\_\+t $\ast$ {\bfseries pico\+\_\+get\+\_\+metadata} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico, offset\+\_\+t position, offset\+\_\+t length)}\label{pico_8c_a61cae890d818d0d96c89ced46eb55fa6}

\item 
\hypertarget{pico_8c_a263a52d3c5d453e6c9780310a3e6fa5e}{bool {\bfseries pico\+\_\+set\+\_\+metadata} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico, offset\+\_\+t position, offset\+\_\+t length, uint8\+\_\+t $\ast$md)}\label{pico_8c_a263a52d3c5d453e6c9780310a3e6fa5e}

\item 
uint8\+\_\+t $\ast$ \hyperlink{pico_8c_a41f77fc21d8c540f914d806f7404b051}{crypt} (uint8\+\_\+t $\ast$data, size\+\_\+t len, uint8\+\_\+t $\ast$key, keylen\+\_\+t keylen, size\+\_\+t position)
\begin{DoxyCompactList}\small\item\em Encrypt or decrypt the data in place using the provided key. \end{DoxyCompactList}\item 
\hypertarget{pico_8c_a3eea8332a90ca54c408a25a7564115b9}{size\+\_\+t {\bfseries pico\+\_\+get} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico, size\+\_\+t position, size\+\_\+t length, uint8\+\_\+t $\ast$buffer)}\label{pico_8c_a3eea8332a90ca54c408a25a7564115b9}

\item 
\hypertarget{pico_8c_acb48f8392117ba6379a3c6ee1a92dd33}{size\+\_\+t {\bfseries pico\+\_\+set} (\hyperlink{struct_p_i_c_o}{P\+I\+C\+O} $\ast$pico, size\+\_\+t position, size\+\_\+t length, uint8\+\_\+t $\ast$data)}\label{pico_8c_acb48f8392117ba6379a3c6ee1a92dd33}

\item 
\hypertarget{pico_8c_ab60ac576f81d3a21444a493dba597302}{\hyperlink{pico__errno_8h_a7ddd7f611d53c5fe4d792f093a08ef48}{pico\+\_\+errno} {\bfseries encode\+\_\+file} (char $\ast$infile, char $\ast$outfile, keylen\+\_\+t key\+\_\+length, uint8\+\_\+t $\ast$key, offset\+\_\+t md\+\_\+length, F\+I\+L\+E $\ast$err)}\label{pico_8c_ab60ac576f81d3a21444a493dba597302}

\item 
\hypertarget{pico_8c_aab395a2ae9141ce77c025bd6d2824cc7}{\hyperlink{pico__errno_8h_a7ddd7f611d53c5fe4d792f093a08ef48}{pico\+\_\+errno} {\bfseries decode\+\_\+file} (char $\ast$infile, char $\ast$outfile, bool header, F\+I\+L\+E $\ast$err)}\label{pico_8c_aab395a2ae9141ce77c025bd6d2824cc7}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Implementation and private A\+P\+I for C\+Pico. 



Definition in file \hyperlink{pico_8c_source}{pico.\+c}.



\subsection{Macro Definition Documentation}
\hypertarget{pico_8c_a69eb2cda55434e5ca8f3fe39f1fd7e1f}{\index{pico.\+c@{pico.\+c}!E\+R\+R@{E\+R\+R}}
\index{E\+R\+R@{E\+R\+R}!pico.\+c@{pico.\+c}}
\subsubsection[{E\+R\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+R\+R(
\begin{DoxyParamCaption}
\item[{}]{m\+\_\+err, }
\item[{}]{m\+\_\+fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)~if ((m\+\_\+err) != N\+U\+L\+L) fprintf((m\+\_\+err), (m\+\_\+fmt), \#\#\+\_\+\+\_\+\+V\+A\+\_\+\+A\+R\+G\+S\+\_\+\+\_\+)}}\label{pico_8c_a69eb2cda55434e5ca8f3fe39f1fd7e1f}


Print an error message. 

This works like fprintf. 
\begin{DoxyParams}{Parameters}
{\em m\+\_\+err} & The stream. If N\+U\+L\+L, suppress the message. \\
\hline
{\em m\+\_\+fmt} & The format string. \\
\hline
\end{DoxyParams}


Definition at line 592 of file pico.\+c.

\hypertarget{pico_8c_a163fdf4775fad44f81a5cf0def9552a9}{\index{pico.\+c@{pico.\+c}!T\+R\+Y@{T\+R\+Y}}
\index{T\+R\+Y@{T\+R\+Y}!pico.\+c@{pico.\+c}}
\subsubsection[{T\+R\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+R\+Y(
\begin{DoxyParamCaption}
\item[{}]{m\+\_\+operation}
\end{DoxyParamCaption}
)~if (m\+\_\+operation != 0)}}\label{pico_8c_a163fdf4775fad44f81a5cf0def9552a9}


Simple macro to check for an error using the usual non-\/zero return value. 

Follow this with a block to execute on error. 
\begin{DoxyParams}{Parameters}
{\em m\+\_\+operation} & The operation to try. \\
\hline
\end{DoxyParams}


Definition at line 23 of file pico.\+c.



\subsection{Function Documentation}
\hypertarget{pico_8c_a41f77fc21d8c540f914d806f7404b051}{\index{pico.\+c@{pico.\+c}!crypt@{crypt}}
\index{crypt@{crypt}!pico.\+c@{pico.\+c}}
\subsubsection[{crypt}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t$\ast$ crypt (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{size\+\_\+t}]{len, }
\item[{uint8\+\_\+t $\ast$}]{key, }
\item[{keylen\+\_\+t}]{keylen, }
\item[{size\+\_\+t}]{position}
\end{DoxyParamCaption}
)}}\label{pico_8c_a41f77fc21d8c540f914d806f7404b051}


Encrypt or decrypt the data in place using the provided key. 


\begin{DoxyParams}{Parameters}
{\em data} & The data to encrypt or decrypt. \\
\hline
{\em len} & Length of the data array. \\
\hline
{\em key} & The encryption key. \\
\hline
{\em keylen} & The number of bytes in the key. \\
\hline
{\em position} & The position of the data in the overall data stream. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The data. 
\end{DoxyReturn}


Definition at line 521 of file pico.\+c.

\hypertarget{pico_8c_adf2b69a7537df96d4c1715b9916aa6a6}{\index{pico.\+c@{pico.\+c}!pico\+\_\+free@{pico\+\_\+free}}
\index{pico\+\_\+free@{pico\+\_\+free}!pico.\+c@{pico.\+c}}
\subsubsection[{pico\+\_\+free}]{\setlength{\rightskip}{0pt plus 5cm}void pico\+\_\+free (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{ptr}
\end{DoxyParamCaption}
)}}\label{pico_8c_adf2b69a7537df96d4c1715b9916aa6a6}


Deallocate the given memory. 

Internally the Pico library may use a non-\/standard malloc / free, so it is important that data allocated by the library be freed using this method. D\+O N\+O\+T U\+S\+E F\+R\+E\+E! 

Definition at line 38 of file pico.\+c.

